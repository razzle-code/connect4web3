<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect4 DApp</title>
    <style>
        #gameBoard td {
            width: 50px;
            height: 50px;
            border: 1px solid black;
            background-color: white;
        }

        #gameBoard .player1 {
            background-color: red;
        }

        #gameBoard .player2 {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <div id="lobby">
        <h2>Lobby</h2>
        <button id="createGame">Create Game</button>
        <input type="text" id="betAmount" placeholder="Enter bet amount in ETH">
        <div id="gamesList"></div>
    </div>

    <div id="gameBoard" style="display: none;">
        <table>
            <tbody id="board">
                <!-- Rows will be added dynamically -->
            </tbody>
        </table>
        <button onclick="makeMove(0)">Column 1</button>
        <button onclick="makeMove(1)">Column 2</button>
        <!-- ... Add buttons for all columns -->
    </div>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.5/dist/web3.min.js"></script>
    <script>
        // Assuming MetaMask is installed
        const web3 = new Web3(window.ethereum);
        let accounts = [];
        let contract;

        async function init() {
            accounts = await web3.eth.getAccounts();
            contract = new web3.eth.Contract([{"anonymous":false,"inputs":[],"name":"GameDraw","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"player1","type":"address"},{"indexed":false,"internalType":"address","name":"player2","type":"address"},{"indexed":false,"internalType":"uint256","name":"betAmount","type":"uint256"}],"name":"GameStarted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"winner","type":"address"}],"name":"GameWon","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint8","name":"column","type":"uint8"}],"name":"MoveMade","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"PrizeClaimed","type":"event"},{"inputs":[],"name":"betAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"board","outputs":[{"internalType":"enum ConnectFour.Player","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"currentPlayer","outputs":[{"internalType":"enum ConnectFour.Player","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"gameEnded","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint8","name":"column","type":"uint8"}],"name":"makeMove","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"player1","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"player2","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_player1","type":"address"},{"internalType":"address","name":"_player2","type":"address"},{"internalType":"uint256","name":"_betAmount","type":"uint256"}],"name":"startGame","outputs":[],"stateMutability":"payable","type":"function"}]
, 0xf718e3Ec4c25598E3946cb0F634d7aA017f38BeB);

            document.getElementById('createGame').addEventListener('click', createGame);
        }

        async function createGame() {
            const betAmount = web3.utils.toWei(document.getElementById('betAmount').value, 'ether');
            await contract.methods.startGame(accounts[0], accounts[1], betAmount).send({ from: accounts[0], value: 2 * betAmount });
            // Update the gamesList or navigate to the game board
        }

        const rows = 6;
        const columns = 7;
        let board = [];

        function initBoard() {
            board = Array(rows).fill().map(() => Array(columns).fill(Player.NONE));
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            for (let i = 0; i < rows; i++) {
                const rowElement = document.createElement('tr');
                for (let j = 0; j < columns; j++) {
                    const cellElement = document.createElement('td');
                    cellElement.dataset.row = i;
                    cellElement.dataset.column = j;
                    rowElement.appendChild(cellElement);
                }
                boardElement.appendChild(rowElement);
            }
        }

        async function makeMove(column) {
            // Call the smart contract's makeMove function
            await contract.methods.makeMove(column).send({ from: accounts[0] });
        }

        // Listen to the MoveMade event from the contract
        contract.events.MoveMade({}, (error, event) => {
            if (error) {
                console.error(error);
                return;
            }
            const { player, column } = event.returnValues;
            updateBoard(player, column);
        });

        function updateBoard(player, column) {
            // Find the first empty cell in the column
            for (let i = rows - 1; i >= 0; i--) {
                if (board[i][column] === Player.NONE) {
                    board[i][column] = player;
                    const cell = document.querySelector(`[data-row="${i}"][data-column="${column}"]`);
                    cell.className = player === Player.PLAYER1 ? 'player1' : 'player2';
                    break;
                }
            }
        }

        // Initialize the board when the page loads
        initBoard();
    </script>
</body>
</html>
